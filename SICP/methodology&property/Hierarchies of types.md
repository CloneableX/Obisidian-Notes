### 类型层次结构

类型转换的情况除了将 A 类型直接转换为 B 类型之外，也可能通过第三种类型进行转换，这种情况无法直接使用[强制转换](obsidian://open?vault=SICP&file=methodology%26property%2FCoercion)处理。要解决这种情况需要构建类型层次结构，如果这个结构中的每个类型都只有一种超类型和子类型则称为塔型结构。具体结构如下图。

![](https://github.com/CloneableX/SICP-learning/wiki/images/2/2-25.png)

在塔型结构中，如果需要转换类型可以逐层转换直至转换为目标类型即可。不仅如此，塔型结构中的子类型也可以自动继承超类型中的方法，因为当某个类型无法应用于对应方法时可以通过塔型结构进行转换，直到转换为符合应用方法的类型。除从下至上的转换外，也可以通过从上至下的类型转换完成简化功能，比如 `6 + 0i` 结果应该是整数 `6`。

除了上述优点外，它也存在着不足。因为通常情况下，塔型结构并不常见，而多个子类型或多个超类型的情况才是常态。这导致无论是升级类型还是降级类型时会出现多条路径，为了确保最后能够转换为目标类型则需要查验整个类型结构网络。所以在设计大型系统时，既需要处理大量类型关系，又要保持模块化是十分困难的事情，这也是目前需要重点研究的领域。